<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Bayesian radiocarbon chronology package Bchron • Bchron</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Bayesian radiocarbon chronology package Bchron">
<meta property="og:description" content="Bchron">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Bchron</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Bchron.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewcparnell/Bchron/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Bayesian radiocarbon chronology package Bchron</h1>
                        <h4 class="author">Andrew Parnell</h4>
            
            <h4 class="date">2020-04-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewcparnell/Bchron/blob/master/vignettes/Bchron.Rmd"><code>vignettes/Bchron.Rmd</code></a></small>
      <div class="hidden name"><code>Bchron.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Bchron is an R package that enables quick calibration of radiocarbon dates under various calibration curves (including user generated ones); age-depth modelling as per the algorithm of Haslett and Parnell (2008); Relative sea level rate estimation incorporating time uncertainty in polynomial regression models (Parnell and Gehrels 2015); non-parametric phase modelling via Gaussian mixtures as a means to determine the activity of a site (and as an alternative to the Oxcal function SUM; currently unpublished), and reverse calibration of dates from calibrated into un-calibrated years.</p>
<p>You will find Bchron far easier to use if you know some basics on how to use R. I recommend the book by Norman Matloff <a href="https://www.amazon.co.uk/The-Art-Programming-Statistical-Software/dp/1593273843">amazon.co.uk link</a>, or the online courses by <a href="https://www.pluralsight.com">Pluralsight</a></p>
<p>If you find bugs or want to suggest new features please visit the Bchron <a href="https://github.com/andrewcparnell/Bchron/issues">GitHub issues page</a>.</p>
</div>
<div id="installing-bchron" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-bchron" class="anchor"></a>Installing Bchron</h2>
<p>Bchron will run in Windows, Mac OS X or Linux. To install Bchron you first need to install <a href="https://www.r-project.org">R</a>. I would also recommend installing <a href="http://www.rstudio.com">Rstudio</a> as a nice desktop environment for using R. Once in R you can type:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'Bchron'</span>)</pre></body></html></div>
<p>at the R command prompt to install Bchron. If you then type:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Bchron</span>)</pre></body></html></div>
<p>it will load in all the Bchron functions.</p>
<p>If you want to install the development version of Bchron please visit the Bchron <a href="https://github.com/andrewcparnell/Bchron">GitHub page</a>. The GitHub version contains a few more features but some of these can be quite untested, and occasionally this version will break when it is in the process of being updated.</p>
</div>
<div id="calibrating-radiocarbon-dates" class="section level2">
<h2 class="hasAnchor">
<a href="#calibrating-radiocarbon-dates" class="anchor"></a>Calibrating radiocarbon dates</h2>
<p>Bchron will calibrate single or multiple dates under multiple (even user defined) calibration curves. By default, the intcal13, shcal13 and marine13 calibration curves are included. You can calibrate a single radiocarbon date with, e.g.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ages1</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="fl">11553</span>,
                        <span class="kw">ageSds</span><span class="kw">=</span><span class="fl">230</span>,
                        <span class="kw">calCurves</span><span class="kw">=</span><span class="st">'intcal13'</span>,
                        <span class="kw">ids</span><span class="kw">=</span><span class="st">'Ox-123456'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ages1</span>)</pre></body></html></div>
<pre><code>## 95% Highest density regions for Ox-123456
## $`84.9%`
## [1] 12953 13863
## 
## $`9.7%`
## [1] 13886 13939</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">ages1</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This will calibrate the radiocarbon age of 11,553 14C years BP with standard error 230 14C years on the intcal13 calibration curve. The <code>id</code> given is optional and only used for summarising and plotting. The summary command then gives the highest density regions of the calibrated date and the plot command produces a simple plot of the density, together with a shaded region for the 95% highest density region.</p>
<p>Bchron can calibrate multiple dates simultaneously by inputting the dates as vectors:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ages2</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3445</span>,<span class="fl">11553</span>,<span class="fl">7456</span>),
                        <span class="kw">ageSds</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">50</span>,<span class="fl">230</span>,<span class="fl">110</span>),
                        <span class="kw">calCurves</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'intcal13'</span>,<span class="st">'intcal13'</span>,<span class="st">'shcal13'</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ages2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">ages2</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"><img src="Bchron_files/figure-html/unnamed-chunk-4-2.png" width="672" style="display: block; margin: auto;"><img src="Bchron_files/figure-html/unnamed-chunk-4-3.png" width="672" style="display: block; margin: auto;"></p>
<p>This will calibrate three different 14C ages with the calibration curves as specified in the <code>calCurves</code> argument. The <code>summary</code> and <code>plot</code> commands will produce individual highest density regions and density plots for the three dates.</p>
<p>Finally, if you provide position information (e.g. depths) to the BchronCalibrate function it will create a plot with position on the y-axis, e.g.:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ages3</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1000</span>,<span class="fl">11553</span>),
                        <span class="kw">ageSds</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">50</span>,<span class="fl">230</span>),
                        <span class="kw">positions</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>,<span class="fl">150</span>),
                        <span class="kw">calCurves</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'intcal13'</span>,<span class="st">'normal'</span>))
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">ages3</span>)</pre></body></html></div>
<pre><code>## 95% Highest density regions for Date1
## $`77.7%`
## [1] 789 988
## 
## $`16.3%`
## [1] 1030 1047
## 
## 
## 95% Highest density regions for Date2
## $`94.7%`
## [1] 11100 12005</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">ages3</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>… or change the axes/titles if you want:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">ages3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Age (years BP)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Depth (cm)'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Two dates at different depths'</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>… or change to BC/AD</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">ages3</span>, <span class="kw">ageScale</span> <span class="kw">=</span> <span class="st">'bc'</span>, <span class="kw">scaleReverse</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Age (years BC/AD)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Depth (cm)'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Two dates at different depths'</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="credible-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#credible-intervals" class="anchor"></a>Credible intervals</h2>
<p>If, alternatively, you want a <em>credible interval</em> (i.e. a single contiguous range) rather than an HDR, you could use the <code>sampleAges</code> function:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># First create age samples for each date</span>
<span class="no">age_samples</span> <span class="kw">=</span> <span class="fu"><a href="../reference/sampleAges.html">sampleAges</a></span>(<span class="no">ages3</span>)
<span class="co"># Now summarise them with quantile - this gives a 95% credible interval</span>
<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">age_samples</span>, <span class="fl">2</span>, <span class="no">quantile</span>, <span class="kw">prob</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))</pre></body></html></div>
<pre><code>##       Date1 Date2
## 2.5%    795 11094
## 97.5%  1036 12017</code></pre>
<p>The <code>sampleAges</code> function introduces some uncertainty as it is a simple random sample. This means that repeatedly running it will give you slightly different results. If you require precision at a yearly level, you might want to increase the <code>n_samp</code> argument though will slow the function down a little.</p>
<p>If you wanted to find each date’s median age (though this is often an inappropriate summary and should be treated with caution), use:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">age_samples</span>, <span class="fl">2</span>, <span class="no">quantile</span>, <span class="kw">prob</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>))</pre></body></html></div>
<pre><code>## Date1 Date2 
##   912 11555</code></pre>
<p>The calibration code is very fast. On a standard PC you should have no trouble calibrating thousands of dates simultaneously without a noticeably long wait.</p>
</div>
<div id="comparing-ages" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-ages" class="anchor"></a>Comparing ages</h2>
<p>If you want to compare two dates, a good method is to look at the posterior difference between them. Because Bchron provides all the information about the dates through the <code>sample_ages</code> function, this difference can be calculated in just a few lines of code.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">age_diff</span> <span class="kw">=</span> <span class="no">age_samples</span>[,<span class="fl">2</span>] - <span class="no">age_samples</span>[,<span class="fl">1</span>]
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">qplot</a></span>(<span class="no">age_diff</span>, <span class="kw">geom</span> <span class="kw">=</span> <span class="st">'histogram'</span>, <span class="kw">bins</span> <span class="kw">=</span> <span class="fl">30</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">'Age difference between 3445+/-50 and 11553+/-230'</span>,
     <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">'Frequency'</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">'Age difference'</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="running-the-bchronology-age-depth-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-bchronology-age-depth-model" class="anchor"></a>Running the Bchronology age-depth model</h2>
<p>The Bchronology function fits the age-depth model outlined by Haslett and Parnell (2008). An illustrative data set from Glendalough is provided with the package, containing 5 radiocarbon dates and a known age for the top of the core. It can be called in via:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">Glendalough</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">Glendalough</span>)</pre></body></html></div>
<pre><code>##            id  ages ageSds position thickness calCurves
## 1       Top-1     0      1        0         0    normal
## 2 Beta-122061  2310     60      426         4  intcal13
## 3 Beta-100901  9150     50     1166         4  intcal13
## 4 Beta-100900  9810     60     1204         4  intcal13
## 5 Beta-100899 10940     60     1383         2  intcal13
## 6 Beta-100897 11550     60     1433         2  intcal13</code></pre>
<p>The top date is from the present and has the calibration curve ‘normal’ as it is not a 14C date. This core can be run through Bchron via:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">GlenOut</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">Glendalough</span>,
               <span class="fu"><a href="../reference/Bchronology.html">Bchronology</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="no">ages</span>,
                           <span class="kw">ageSds</span><span class="kw">=</span><span class="no">ageSds</span>,
                           <span class="kw">calCurves</span><span class="kw">=</span><span class="no">calCurves</span>,
                           <span class="kw">positions</span><span class="kw">=</span><span class="no">position</span>,
                           <span class="kw">positionThicknesses</span><span class="kw">=</span><span class="no">thickness</span>,
                           <span class="kw">ids</span><span class="kw">=</span><span class="no">id</span>,
                           <span class="kw">predictPositions</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1500</span>,<span class="kw">by</span><span class="kw">=</span><span class="fl">10</span>)))</pre></body></html></div>
<p>There are other arguments you can supply to Bchronology, including the date the core was extracted, the outlier probabilities for each individual date, and the number of iterations for which to run the algorithm. For more details see:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span>(<span class="no">Bchronology</span>)</pre></body></html></div>
<p>Once run, the summary commands will show various output:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>)</pre></body></html></div>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">'convergence'</span>)</pre></body></html></div>
<pre><code>## Convergence check (watch for too many small p-values): 
##             p-value
## RateMean    0.00000
## RateVar     0.00298
## Outlier 1   0.07844
## Beta-100900 0.09666
## Top-1       0.13839
## Outlier 6   0.14152
## Outlier 3   0.17407
## Outlier 2   0.21691
## Beta-122061 0.24490
## Beta-100897 0.26297
## Outlier 5   0.35450
## Beta-100899 0.40507
## Beta-100901 0.46072
## Outlier 4   0.49709</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">'outliers'</span>)</pre></body></html></div>
<pre><code>## Posterior outlier probability by date: 
##         Date OutlierProb
##        Top-1       0.006
##  Beta-122061       0.008
##  Beta-100901       0.009
##  Beta-100900       0.013
##  Beta-100899       0.009
##  Beta-100897       0.010</code></pre>
<p>The first summary command produces ages for each position supplied in the <code>predictPositions</code> argument above (output not shown as it’s too long). The second provides convergence diagnostics. The third gives outlier probabilities. The <code>plot</code> command will produce an age-position plot:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">GlenOut</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Finally, the <code>predict</code> command will produce predicted ages for a newly specified set of positions with optional thicknesses:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">predictAges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">GlenOut</span>,
                      <span class="kw">newPositions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">150</span>,<span class="fl">725</span>,<span class="fl">1500</span>),
                      <span class="kw">newPositionThicknesses</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">0</span>,<span class="fl">20</span>))
<span class="no">predictAges</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">GlenOut</span>,
                      <span class="kw">newPositions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1500</span>,<span class="kw">by</span><span class="kw">=</span><span class="fl">10</span>))</pre></body></html></div>
<p>To run this model on a data set of your own, you will need to load in your data set via, e.g.</p>
<pre><code>mydata = read.table(file='path/to/file.txt',header=TRUE)
run = Bchronology(ages=mydata[,1],ageSds=mydata[,2], ...</code></pre>
<div id="obtaining-sedimentation-and-accumulation-rates" class="section level3">
<h3 class="hasAnchor">
<a href="#obtaining-sedimentation-and-accumulation-rates" class="anchor"></a>Obtaining sedimentation and accumulation rates</h3>
<p>The summary function used above also allows for calculation of sedimentation and accumulation rates. Here is an example of calculating and plotting the accumulation rate for the <code>GlenOut</code> object created above:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">acc_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'acc_rate'</span>,
                   <span class="kw">probs</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</pre></body></html></div>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">acc_rate_2</span> <span class="kw">=</span> <span class="no">acc_rate</span> <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">Percentile</span>,
         <span class="kw">value</span> <span class="kw">=</span> <span class="no">value</span>,
         -<span class="no">age_grid</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">acc_rate_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">age_grid</span>,
                     <span class="kw">y</span> <span class="kw">=</span> <span class="no">value</span>,
                     <span class="kw">colour</span> <span class="kw">=</span> <span class="no">Percentile</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_reverse</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">'cm per year'</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Age (cal years BP)'</span>)</pre></body></html></div>
<p>Clearly these accumulation rates are very uncertain, which is unsurprising given the paucity of dates.</p>
<p>To calculate sedimentation rates, you need to either make sure that the <code>predictPositions</code> argument in the <code>Bchronology</code> call above is given with unit differences (e.g. <code>predictPositions=seq(0,1500,by=1)</code>) or set the argument <code>useExisting=FALSE</code> in the command below:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">sed_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'sed_rate'</span>, <span class="kw">useExisting</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                   <span class="kw">probs</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</pre></body></html></div>
<p>This will be quite slow as it needs to predict ages on a regular unit depth grid. However, the plots can be created in the same way:</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">sed_rate_2</span> <span class="kw">=</span> <span class="no">sed_rate</span> <span class="kw">%&gt;%</span>
  <span class="fu">gather</span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">Percentile</span>,
         <span class="kw">value</span> <span class="kw">=</span> <span class="no">value</span>,
         -<span class="no">position_grid</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">sed_rate_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">position_grid</span>,
                     <span class="kw">y</span> <span class="kw">=</span> <span class="no">value</span>,
                     <span class="kw">colour</span> <span class="kw">=</span> <span class="no">Percentile</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_reverse</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">'Years per cm'</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Depth (cm)'</span>)</pre></body></html></div>
<p>You could then for example save this to a csv file with, e.g. <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv(sed_rate, file = 'Glendalough_sed_rates.csv', quote=FALSE, row.names = FALSE)</a></code></p>
</div>
</div>
<div id="identifying-influential-dates-and-positions" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-influential-dates-and-positions" class="anchor"></a>Identifying influential dates and positions</h2>
<p>Bchron contains two functions which can help with future dating strategies. They are:</p>
<ol style="list-style-type: decimal">
<li>Identifying the position at which the maximum age variance occurs. This is useful if you wanted to pick the one next position to date</li>
<li>Identifying which date is the most influential on the chronology. This is useful if you are concerned that one date might be leading the chronology astray.</li>
</ol>
<p>Identifying the position of maximum age variance can be created with the <code>summary</code> command:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'max_var'</span>)</pre></body></html></div>
<pre><code>## Top 3 positions with maximum age variance are: 
## 800 790 810</code></pre>
<p>You can control the number of positions reported with <code>numPos</code>. For example you could now add a line to mark the most variably layer to the plot with:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">max_var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">GlenOut</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'max_var'</span>, <span class="kw">numPos</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<pre><code>## Position with maximum age variance is: 
## 800</code></pre>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">GlenOut</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Glendalough"</span>,
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">'Age (cal years BP)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Depth (cm)'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">max_var</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Finding the date which has maximum influence in the core is a more computationally intensive procedure and involves running the Bchron model repeatedly, leaving each date out in turn, and quantifying the effect on the chronology of removing each date. The function is called <code>dateInfluence</code>. Note that you provide this function with a full run of the Bchron model.</p>
<p>To find the influence, say, of date <code>Beta-100901</code> as the median date shift in years when is removed, we would run:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="fu"><a href="../reference/dateInfluence.html">dateInfluence</a></span>(<span class="no">GlenOut</span>,
              <span class="kw">whichDate</span> <span class="kw">=</span> <span class="st">'Beta-100901'</span>,
              <span class="kw">measure</span> <span class="kw">=</span> <span class="st">'absMedianDiff'</span>)</pre></body></html></div>
<p>Alternatively, to find the influence of all the dates in terms of the median shift we could use:</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu"><a href="../reference/dateInfluence.html">dateInfluence</a></span>(<span class="no">GlenOut</span>,
              <span class="kw">whichDate</span> <span class="kw">=</span> <span class="st">'all'</span>,
              <span class="kw">measure</span> <span class="kw">=</span> <span class="st">'absMedianDiff'</span>)</pre></body></html></div>
<p>A more complete measure of influence is the Kullback-Leibler (KL) divergence which takes account of the change in the full probability distribution rather than just looking at mean or median age differences when that particular date is left out. The KL divergence version could then be run using:</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu"><a href="../reference/dateInfluence.html">dateInfluence</a></span>(<span class="no">GlenOut</span>,
              <span class="kw">whichDate</span> <span class="kw">=</span> <span class="st">'all'</span>,
              <span class="kw">measure</span> <span class="kw">=</span> <span class="st">'KL'</span>)</pre></body></html></div>
<p>The interpretation here is relative. The dates with the largest KL divergence values have the most influence on the chronology in the core.</p>
</div>
<div id="running-rsl-rate-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#running-rsl-rate-estimation" class="anchor"></a>Running RSL rate estimation</h2>
<p>The function <code>BchronRSL</code> will produce estimated relative sea level rates from a regression model taking into account the uncertainties in age provided by a <code>Bchronology</code> run as above. Two example data sets are provided:</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">TestChronData</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">TestRSLData</span>)</pre></body></html></div>
<p>These can be run through Bchronology and BchronRSL via:</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">RSLchron</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">TestChronData</span>,
                <span class="fu"><a href="../reference/Bchronology.html">Bchronology</a></span>(<span class="kw">ages</span> <span class="kw">=</span> <span class="no">ages</span>,
                            <span class="kw">ageSds</span> <span class="kw">=</span> <span class="no">ageSds</span>,
                            <span class="kw">positions</span> <span class="kw">=</span> <span class="no">position</span>,
                            <span class="kw">positionThicknesses</span> <span class="kw">=</span> <span class="no">thickness</span>,
                            <span class="kw">ids</span> <span class="kw">=</span> <span class="no">id</span>,
                            <span class="kw">calCurves</span> <span class="kw">=</span> <span class="no">calCurves</span>,
                            <span class="kw">jitterPositions</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                            <span class="kw">predictPositions</span> <span class="kw">=</span> <span class="no">TestRSLData</span>$<span class="no">Depth</span>))
<span class="no">RSLrun</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">TestRSLData</span>,
              <span class="fu"><a href="../reference/BchronRSL.html">BchronRSL</a></span>(<span class="no">RSLchron</span>,
                        <span class="kw">RSLmean</span> <span class="kw">=</span> <span class="no">RSL</span>,
                        <span class="kw">RSLsd</span> <span class="kw">=</span> <span class="no">Sigma</span>,
                        <span class="kw">degree</span> <span class="kw">=</span> <span class="fl">3</span>))</pre></body></html></div>
<p>The <code>Bchronology</code> run is as described in the section above. The <code>BChronRSL</code> run takes this object, an estimate of the RSL means and standard deviations, and a value of degree (here 3 indicating cubic regression). They can then be summarised and plotted via:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">RSLrun</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'RSL'</span>, <span class="kw">age_grid</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">2000</span>, <span class="kw">by</span>  <span class="kw">=</span> <span class="fl">250</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">RSLrun</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'RSL'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Relative sea level plot'</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">RSLrun</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'rate'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Rate of RSL change'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">'Rate (mm per year)'</span>)</pre></body></html></div>
<p>See the help files for more options, including outputting parameter values, and plots of acceleration of RSL itself.</p>
</div>
<div id="running-non-parametric-phase-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#running-non-parametric-phase-estimation" class="anchor"></a>Running non-parametric phase estimation</h2>
<p>Bchron contains two functions for running non-parametric phase models for estimating activity level in a site/region. The first, BchronDensity fits a full Bayesian Gaussian mixture model to the radiocarbon dates whilst the second <code>BchronDensityFast</code> fits an approximate version which will run on much larger data sets. An example run is</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">Sluggan</span>)
<span class="no">SlugDens</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronDensity.html">BchronDensity</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">ages</span>,
                         <span class="kw">ageSds</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">ageSds</span>,
                         <span class="kw">calCurves</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">calCurves</span>)</pre></body></html></div>
<p>You can then output the possible start/end dates of phases:</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">SlugDens</span>, <span class="kw">prob</span> <span class="kw">=</span> <span class="fl">0.95</span>)</pre></body></html></div>
<p>The probability argument will specify the sensitivity of the algorithm to finding phases. Lower values of <code>prob</code> will lead to more discovered phases.</p>
<p>You can plot the density with:</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">SlugDens</span>,<span class="kw">xlab</span><span class="kw">=</span><span class="st">'Age (cal years BP)'</span>, <span class="kw">xaxp</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">16000</span>, <span class="fl">16</span>))</pre></body></html></div>
<p>Phases will be shown with a thick black red line. These can be turned off by setting the argument <code>plotPhase=FALSE</code> whilst the sensitivity can be changed with <code>phaseProb</code>.</p>
<p><code>BchronDensityFast</code> is identical except for the function call:</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">SlugDensFast</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronDensityFast.html">BchronDensityFast</a></span>(<span class="kw">ages</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">ages</span>,
                                 <span class="kw">ageSds</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">ageSds</span>,
                                 <span class="kw">calCurves</span><span class="kw">=</span><span class="no">Sluggan</span>$<span class="no">calCurves</span>)</pre></body></html></div>
<p>The <code>BchronDensityFast</code> function outputs the age grid and density by default so requires no extra arguments to store it.</p>
</div>
<div id="including-user-defined-calibration-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#including-user-defined-calibration-curves" class="anchor"></a>Including user-defined calibration curves</h2>
<p>Bchron allows for user-defined calibration curves to be created through the function <code>createCalCurve</code>. If inputs to this function are:</p>
<ul>
<li>The <code>name</code> of the calibration curve (e.g. intcal13c)</li>
<li>The calibrated/calendar ages for the new calibration curve</li>
<li>The uncalibrated (e.g. 14C) ages for the new calibration curve</li>
<li>(Optionally) the 1-sigma error for the calibration curve in uncalibrated years. If not included the error is assumed to be zero</li>
<li>(Optionally) The path to where the resulting file will be stored</li>
</ul>
<p>Once run, the calibration curve needs to be moved from the chosen path (by default the working directory) to the location of the other calibration curves. This is by default <code><a href="https://rdrr.io/r/base/system.file.html">system.file('data',package='Bchron')</a></code>. The resulting calibration curve can be used for all future runs until the package is deleted or re-installed. The calibration curve can be used by simply calling it in any other Bchron function using the supplied name. Note that no name checking is done, so it is possible to over-write the pre-defined calibration curves if the user is not careful.</p>
<p>We now consider an example of loading in and creating the IntCal09 calibration curve:</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="co"># Load in the calibration curve with:</span>
<span class="no">intcal09</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata/intcal09.14c'</span>,
                                  <span class="kw">package</span> <span class="kw">=</span> <span class="st">'Bchron'</span>), <span class="kw">sep</span><span class="kw">=</span><span class="st">','</span>)

<span class="co"># Run createCalCurve</span>
<span class="fu"><a href="../reference/createCalCurve.html">createCalCurve</a></span>(<span class="kw">name</span><span class="kw">=</span><span class="st">'intcal09'</span>,<span class="kw">calAges</span><span class="kw">=</span><span class="no">intcal09</span>[,<span class="fl">1</span>],
               <span class="kw">uncalAges</span><span class="kw">=</span><span class="no">intcal09</span>[,<span class="fl">2</span>],<span class="kw">oneSigma</span><span class="kw">=</span><span class="no">intcal09</span>[,<span class="fl">3</span>])</pre></body></html></div>
<p>The new calibration curve now needs to be moved to the Bchron package directory. You can do this with the following code:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="st">'intcal09.rda'</span>, <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'data'</span>,<span class="kw">package</span><span class="kw">=</span><span class="st">'Bchron'</span>))</pre></body></html></div>
<p>It can then be used via its name. For example, we can now compare the calibration of a date under the intcal09 curve with that of intcal13:</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">age_09</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">age</span><span class="kw">=</span><span class="fl">15500</span>,<span class="kw">ageSds</span><span class="kw">=</span><span class="fl">150</span>,<span class="kw">calCurves</span> <span class="kw">=</span> <span class="st">'intcal09'</span>,
                         <span class="kw">ids</span><span class="kw">=</span><span class="st">'IntCal09'</span>)
<span class="no">age_13</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">age</span><span class="kw">=</span><span class="fl">15500</span>,<span class="kw">ageSds</span><span class="kw">=</span><span class="fl">150</span>,<span class="kw">calCurves</span> <span class="kw">=</span> <span class="st">'intcal13'</span>,
                         <span class="kw">ids</span> <span class="kw">=</span> <span class="st">'Intcal13'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">age_09</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">age_13</span>$<span class="no">Date1</span>),
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">ageGrid</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">densities</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="st">'red'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">'Intcal09 vs Intcal13'</span>)</pre></body></html></div>
</div>
<div id="uncalibrating-dates" class="section level2">
<h2 class="hasAnchor">
<a href="#uncalibrating-dates" class="anchor"></a>Uncalibrating dates</h2>
<p>Sometimes it is useful to turn a calendar age estimate into an uncalibrated age. This might be for simulation or model checking purposes. ‘Un-calibrating’ dates can be implemented in Bchron using the <code>unCalibrate</code> function. There are two versions, one where you have a single age and just want to get a quick look up of the 14C age, and another where you have the full distribution of the calibrated age and want to estimate both the 14C age and its associated error.</p>
<p>The simple version can be run with, e.g.:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">unCal1</span> <span class="kw">=</span> <span class="fu"><a href="../reference/unCalibrate.html">unCalibrate</a></span>(<span class="fl">2350</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">'ages'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">unCal1</span>)</pre></body></html></div>
<pre><code>## [1] 2346</code></pre>
<p>The above un-calibrates the age 2350 BP to the age 2346 14C years BP on the intcal13 calibration curve. A more advanced version would be:</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">unCal2</span> <span class="kw">=</span> <span class="fu"><a href="../reference/unCalibrate.html">unCalibrate</a></span>(<span class="kw">calAge</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2350</span>, <span class="fl">4750</span>, <span class="fl">11440</span>),
                     <span class="kw">calCurve</span> <span class="kw">=</span> <span class="st">'shcal13'</span>,
                     <span class="kw">type</span> <span class="kw">=</span> <span class="st">'ages'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">unCal2</span>)</pre></body></html></div>
<pre><code>## [1]  2388  4224 10065</code></pre>
<p>A fun experiment can then be run to see what the distribution of 14C ages would look like for an even distribution of calendar ages:</p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="no">ageRange</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">8000</span>, <span class="fl">9000</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">c14Ages</span> <span class="kw">=</span> <span class="fu"><a href="../reference/unCalibrate.html">unCalibrate</a></span>(<span class="no">ageRange</span>,
                      <span class="kw">type</span> <span class="kw">=</span> <span class="st">'ages'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'data/intcal13.rda'</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'Bchron'</span>))
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">intcal13</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">V1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">V2</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">ageRange</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">c14Ages</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">c14Ages</span>), <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">c14Ages</span>),
           <span class="kw">sides</span> <span class="kw">=</span> <span class="st">'l'</span>, <span class="kw">inherit.aes</span> <span class="kw">=</span> <span class="no">F</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">ageRange</span>), <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">ageRange</span>),
           <span class="kw">sides</span> <span class="kw">=</span> <span class="st">'b'</span>, <span class="kw">inherit.aes</span> <span class="kw">=</span> <span class="no">F</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Calendar years BP'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'14C years BP'</span>)</pre></body></html></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Unsurprisingly the places where the calibration curve is flat (or reverses) leads to ‘clumps’ of calendar ages.</p>
<p>The more complicated version is run by providing it with a (preferably large) sample of ages which form a calibrated date. Such a set is created with Bchron via <code>sampleAges</code>, e.g.:</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">calAge</span> <span class="kw">=</span> <span class="fu"><a href="../reference/BchronCalibrate.html">BchronCalibrate</a></span>(<span class="kw">ages</span> <span class="kw">=</span> <span class="fl">11255</span>,
                         <span class="kw">ageSds</span> <span class="kw">=</span> <span class="fl">25</span>,
                         <span class="kw">calCurves</span> <span class="kw">=</span> <span class="st">'intcal13'</span>)
<span class="no">calSampleAges</span> <span class="kw">=</span> <span class="fu"><a href="../reference/sampleAges.html">sampleAges</a></span>(<span class="no">calAge</span>)</pre></body></html></div>
<p>We can now uncalibrate such a set of samples</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">unCal</span> <span class="kw">=</span> <span class="fu"><a href="../reference/unCalibrate.html">unCalibrate</a></span>(<span class="no">calSampleAges</span>,
            <span class="kw">type</span> <span class="kw">=</span> <span class="st">'samples'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">unCal</span>)</pre></body></html></div>
<pre><code>## $mean
## [1] 11255
## 
## $sd
## [1] 25</code></pre>
<p>This will provide a single best estimate of the mean and standard deviation of the uncalibrated (here 14C) date.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>For a description of the kind of things that Bchron can do:<br>
Parnell, A. C., Haslett, J., Allen, J. R. M., Buck, C. E., &amp; Huntley, B. (2008). A flexible approach to assessing synchroneity of past events using Bayesian reconstructions of sedimentation history. Quaternary Science Reviews, 27(19-20), 1872–1885.</p>
<p>For the maths behind Bchron:<br>
Haslett, J., &amp; Parnell, A. (2008). A simple monotone process with application to radiocarbon-dated depth chronologies. Journal of the Royal Statistical Society: Series C (Applied Statistics), 57(4), 399–418.</p>
<p>For a review of chronology models:<br>
Parnell, A. C., Buck, C. E., &amp; Doan, T. K. (2011). A review of statistical chronology models for high-resolution, proxy-based Holocene palaeoenvironmental reconstruction. Quaternary Science Reviews, 30(21-22), 2948–2960.</p>
<p>For relative sea level rate estimation:<br>
Parnell, A. C., &amp; Gehrels, W. R. (2015). Using chronological models in late Holocene sea level reconstructions from salt marsh sediments. In: I. Shennan, B.P. Horton, and A.J. Long (eds). Handbook of Sea Level Research. Chichester: Wiley.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andrew Parnell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
