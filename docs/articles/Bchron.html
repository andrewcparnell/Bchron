<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Using Bayesian radiocarbon chronology package Bchron • Bchron</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Using Bayesian radiocarbon chronology package Bchron"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Bchron</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.7.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/Bchron.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/andrewcparnell/Bchron/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header>





<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Bayesian radiocarbon chronology package
Bchron</h1>
                        <h4 data-toc-skip class="author">Andrew
Parnell</h4>
            
            <h4 data-toc-skip class="date">2025-06-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewcparnell/Bchron/blob/HEAD/vignettes/Bchron.Rmd" class="external-link"><code>vignettes/Bchron.Rmd</code></a></small>
      <div class="hidden name"><code>Bchron.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Bchron is an R package that enables quick calibration of radiocarbon
dates under various calibration curves (including user generated ones);
age-depth modelling as per the algorithm of Haslett and Parnell (2008);
Relative sea level rate estimation incorporating time uncertainty in
polynomial regression models (Parnell and Gehrels 2015); non-parametric
phase modelling via Gaussian mixtures as a means to determine the
activity of a site (and as an alternative to the Oxcal function SUM;
currently unpublished), and reverse calibration of dates from calibrated
into un-calibrated years.</p>
<p>You will find Bchron far easier to use if you know some basics on how
to use R. I recommend the book by Norman Matloff <a
href="https://www.amazon.co.uk/The-Art-Programming-Statistical-Software/dp/1593273843">amazon.co.uk
link</a>, or the online courses by <a
href="https://www.pluralsight.com">Pluralsight</a></p>
<p>If you find bugs or want to suggest new features please visit the
Bchron <a href="https://github.com/andrewcparnell/Bchron/issues">GitHub
issues page</a>.</p>
</div>
<div id="installing-bchron" class="section level2">
<h2>Installing Bchron</h2>
<p>Bchron will run in Windows, Mac OS X or Linux. To install Bchron you
first need to install <a href="https://www.r-project.org">R</a>. I would
also recommend installing <a href="https://www.rstudio.com">Rstudio</a>
as a nice desktop environment for using R. Once in R you can type:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;Bchron&quot;</span>)</span></code></pre></div>
<p>at the R command prompt to install Bchron. If you then type:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(Bchron)</span></code></pre></div>
<p>it will load in all the Bchron functions.</p>
<p>If you want to install the development version of Bchron please visit
the Bchron <a href="https://github.com/andrewcparnell/Bchron">GitHub
page</a>. The GitHub version contains a few more features but some of
these can be quite untested, and occasionally this version will break
when it is in the process of being updated.</p>
</div>
<div id="calibrating-radiocarbon-dates" class="section level2">
<h2>Calibrating radiocarbon dates</h2>
<p>Bchron will calibrate single or multiple dates under multiple (even
user defined) calibration curves. By default, the intcal20, shcal20 and
marine20 calibration curves are included (as are older calibration
curves such as intcal13). You can calibrate a single radiocarbon date
with, e.g.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>ages1 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="dv">11553</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="dv">230</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="st">&quot;intcal20&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">ids =</span> <span class="st">&quot;Ox-123456&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">summary</span>(ages1)</span></code></pre></div>
<pre><code>## 95% Highest density regions for Ox-123456
## $`0.4%`
## [1] 13004 13025
## 
## $`77.9%`
## [1] 13059 13874
## 
## $`16.4%`
## [1] 13923 14012</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">plot</span>(ages1)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>This will calibrate the radiocarbon age of 11,553 14C years BP with
standard error 230 14C years on the intcal20 calibration curve. The
<code>id</code> given is optional and only used for summarising and
plotting. The summary command then gives the highest density regions of
the calibrated date and the plot command produces a simple plot of the
density, together with a shaded region for the 95% highest density
region.</p>
<p>Bchron can calibrate multiple dates simultaneously by inputting the
dates as vectors:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>ages2 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">3445</span>, <span class="dv">11553</span>, <span class="dv">7456</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">230</span>, <span class="dv">110</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="fu">c</span>(<span class="st">&quot;intcal20&quot;</span>, <span class="st">&quot;intcal20&quot;</span>, <span class="st">&quot;shcal20&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">summary</span>(ages2)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">plot</span>(ages2)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /><img src="Bchron_files/figure-html/unnamed-chunk-4-2.png" width="672" style="display: block; margin: auto;" /><img src="Bchron_files/figure-html/unnamed-chunk-4-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>This will calibrate three different 14C ages with the calibration
curves as specified in the <code>calCurves</code> argument. The
<code>summary</code> and <code>plot</code> commands will produce
individual highest density regions and density plots for the three
dates.</p>
<p>You can plot individual dates from a calibration of multiple dates by
name or number, e.g.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">plot</span>(ages2, <span class="at">date =</span> <span class="st">&quot;Date3&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">plot</span>(ages2, <span class="at">date =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<p>If you provide position information (e.g. depths) to the
BchronCalibrate function it will create a plot with position on the
y-axis, e.g.:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>ages3 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">3445</span>, <span class="dv">11000</span>),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">200</span>),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">positions =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>),</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="fu">c</span>(<span class="st">&quot;intcal20&quot;</span>, <span class="st">&quot;normal&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">summary</span>(ages3)</span></code></pre></div>
<pre><code>## 95% Highest density regions for Date1
## $`94.4%`
## [1] 3572 3834
## 
## 
## 95% Highest density regions for Date2
## $`94.7%`
## [1] 10606 11394</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">plot</span>(ages3)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>… or change the axes/titles if you want:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">plot</span>(ages3) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age (years BP)&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Depth (cm)&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Two dates at different depths&quot;</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>… or change to BC/AD</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">plot</span>(ages3, <span class="at">ageScale =</span> <span class="st">&quot;bc&quot;</span>, <span class="at">scaleReverse =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age (years BC/AD)&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Depth (cm)&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Two dates at different depths&quot;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>… or add the calibration curve into the plot</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">plot</span>(ages1, <span class="at">includeCal =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>… or add multiple dates into the calibration curve plots</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>ages4 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">3445</span>, <span class="dv">11553</span>, <span class="dv">7456</span>),</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">230</span>, <span class="dv">110</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="fu">rep</span>(<span class="st">&quot;intcal20&quot;</span>, <span class="dv">3</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">plot</span>(ages4, <span class="at">includeCal =</span> <span class="cn">TRUE</span>, <span class="at">fillCol =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="credible-intervals" class="section level2">
<h2>Credible intervals</h2>
<p>If, alternatively, you want a <em>credible interval</em> (i.e. a
single contiguous range) rather than an HDR, you could use the
<code>sampleAges</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># First create age samples for each date</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>age_samples <span class="ot">&lt;-</span> <span class="fu">sampleAges</span>(ages3)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># Now summarise them with quantile - this gives a 95% credible interval</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">apply</span>(age_samples, <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##       Date1 Date2
## 2.5%   3569 10597
## 97.5%  3834 11398</code></pre>
<p>The <code>sampleAges</code> function introduces some uncertainty as
it is a simple random sample. This means that repeatedly running it will
give you slightly different results. If you require precision at a
yearly level, you might want to increase the <code>n_samp</code>
argument though will slow the function down a little.</p>
<p>If you wanted to find each date’s median age (though this is often an
inappropriate summary and should be treated with caution), use:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">apply</span>(age_samples, <span class="dv">2</span>, quantile, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>))</span></code></pre></div>
<pre><code>## Date1 Date2 
##  3706 11000</code></pre>
<p>The calibration code is very fast. On a standard PC you should have
no trouble calibrating thousands of dates simultaneously without a
noticeably long wait.</p>
</div>
<div id="comparing-ages" class="section level2">
<h2>Comparing ages</h2>
<p>If you want to compare two dates, a good method is to look at the
posterior difference between them. Because Bchron provides all the
information about the dates through the <code>sample_ages</code>
function, this difference can be calculated in just a few lines of
code.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>age_diff <span class="ot">&lt;-</span> age_samples[, <span class="dv">2</span>] <span class="sc">-</span> age_samples[, <span class="dv">1</span>]</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">qplot</span>(age_diff,</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">&quot;histogram&quot;</span>, <span class="at">bins =</span> <span class="dv">30</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Age difference between 3445+/-50 and 11553+/-230&quot;</span>,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Age difference&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="running-the-bchronology-age-depth-model"
class="section level2">
<h2>Running the Bchronology age-depth model</h2>
<p>The Bchronology function fits the age-depth model outlined by Haslett
and Parnell (2008). An illustrative data set from Glendalough is
provided with the package, containing 5 radiocarbon dates and a known
age for the top of the core. It can be called in via:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">data</span>(Glendalough)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">print</span>(Glendalough)</span></code></pre></div>
<pre><code>##            id  ages ageSds position thickness calCurves
## 1       Top-1     0      1        0         0    normal
## 2 Beta-122061  2310     60      426         4  intcal20
## 3 Beta-100901  9150     50     1166         4  intcal20
## 4 Beta-100900  9810     60     1204         4  intcal20
## 5 Beta-100899 10940     60     1383         2  intcal20
## 6 Beta-100897 11550     60     1433         2  intcal20</code></pre>
<p>The top date is from the present and has the calibration curve
‘normal’ as it is not a 14C date. This core can be run through Bchron
via:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>GlenOut <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  Glendalough,</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">Bchronology</span>(</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>    <span class="at">ages =</span> ages,</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>    <span class="at">ageSds =</span> ageSds,</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>    <span class="at">calCurves =</span> calCurves,</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>    <span class="at">positions =</span> position,</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>    <span class="at">positionThicknesses =</span> thickness,</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>    <span class="at">ids =</span> id,</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>    <span class="at">predictPositions =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>  )</span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>)</span></code></pre></div>
<p>There are other arguments you can supply to Bchronology, including
the date the core was extracted, the outlier probabilities for each
individual date, and the number of iterations for which to run the
algorithm. For more details see:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">help</span>(Bchronology)</span></code></pre></div>
<p>Once run, the summary commands will show various output:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">summary</span>(GlenOut)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">summary</span>(GlenOut, <span class="at">type =</span> <span class="st">&quot;convergence&quot;</span>)</span></code></pre></div>
<pre><code>## Convergence check (watch for too many small p-values): 
##             p-value
## RateVar     0.00223
## Top-1       0.00356
## Outlier 5   0.02243
## RateMean    0.02364
## Outlier 6   0.04093
## Beta-122061 0.11960
## Beta-100899 0.17535
## Outlier 3   0.25784
## Beta-100897 0.26725
## Outlier 2   0.27414
## Outlier 1   0.35450
## Outlier 4   0.35450
## Beta-100901 0.43618
## Beta-100900 0.46044</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">summary</span>(GlenOut, <span class="at">type =</span> <span class="st">&quot;outliers&quot;</span>)</span></code></pre></div>
<pre><code>## Posterior outlier probability by date: 
##         Date OutlierProb
##        Top-1       0.011
##  Beta-122061       0.013
##  Beta-100901       0.009
##  Beta-100900       0.006
##  Beta-100899       0.008
##  Beta-100897       0.010</code></pre>
<p>The first summary command produces ages for each position supplied in
the <code>predictPositions</code> argument above (output not shown as
it’s too long). The second provides convergence diagnostics. The third
gives outlier probabilities. The <code>plot</code> command will produce
an age-position plot:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">plot</span>(GlenOut)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Finally, the <code>predict</code> command will produce predicted ages
for a newly specified set of positions with optional thicknesses:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>predictAges <span class="ot">&lt;-</span> <span class="fu">predict</span>(GlenOut,</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  <span class="at">newPositions =</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">725</span>, <span class="dv">1500</span>),</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="at">newPositionThicknesses =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>predictAges <span class="ot">&lt;-</span> <span class="fu">predict</span>(GlenOut,</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>  <span class="at">newPositions =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>)</span></code></pre></div>
<p>To run this model on a data set of your own, you will need to load in
your data set via, e.g.</p>
<pre><code>mydata = read.table(file=&#39;path/to/file.txt&#39;,header=TRUE)
run = Bchronology(ages=mydata[,1],ageSds=mydata[,2], ...</code></pre>
<div id="obtaining-sedimentation-and-accumulation-rates"
class="section level3">
<h3>Obtaining sedimentation and accumulation rates</h3>
<p>The summary function used above also allows for calculation of
sedimentation and accumulation rates. Here is an example of calculating
and plotting the accumulation rate for the <code>GlenOut</code> object
created above:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>acc_rate <span class="ot">&lt;-</span> <span class="fu">summary</span>(GlenOut,</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;acc_rate&quot;</span>,</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>acc_rate_2 <span class="ot">&lt;-</span> acc_rate <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    <span class="at">key =</span> Percentile,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    <span class="at">value =</span> value,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    <span class="sc">-</span>age_grid</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  )</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="fu">ggplot</span>(acc_rate_2, <span class="fu">aes</span>(</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  <span class="at">x =</span> age_grid,</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  <span class="at">y =</span> value,</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  <span class="at">colour =</span> Percentile</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;cm per year&quot;</span>,</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age (cal years BP)&quot;</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>  )</span></code></pre></div>
<p>Clearly these accumulation rates are very uncertain, which is
unsurprising given the paucity of dates.</p>
<p>To calculate sedimentation rates, you need to either make sure that
the <code>predictPositions</code> argument in the
<code>Bchronology</code> call above is given with unit differences
(e.g. <code>predictPositions=seq(0,1500,by=1)</code>) or set the
argument <code>useExisting=FALSE</code> in the command below:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>sed_rate <span class="ot">&lt;-</span> <span class="fu">summary</span>(GlenOut,</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;sed_rate&quot;</span>, <span class="at">useExisting =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>)</span></code></pre></div>
<p>This will be quite slow as it needs to predict ages on a regular unit
depth grid. However, the plots can be created in the same way:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>sed_rate_2 <span class="ot">&lt;-</span> sed_rate <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">gather</span>(</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>    <span class="at">key =</span> Percentile,</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>    <span class="at">value =</span> value,</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>    <span class="sc">-</span>position_grid</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  )</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="fu">ggplot</span>(sed_rate_2, <span class="fu">aes</span>(</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>  <span class="at">x =</span> position_grid,</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>  <span class="at">y =</span> value,</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>  <span class="at">colour =</span> Percentile</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Years per cm&quot;</span>,</span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Depth (cm)&quot;</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>  )</span></code></pre></div>
<p>You could then for example save this to a csv file with,
e.g. <code>write.csv(sed_rate, file = 'Glendalough_sed_rates.csv', quote=FALSE, row.names = FALSE)</code></p>
</div>
</div>
<div id="identifying-influential-dates-and-positions"
class="section level2">
<h2>Identifying influential dates and positions</h2>
<p>Bchron contains two functions which can help with future dating
strategies. They are:</p>
<ol style="list-style-type: decimal">
<li>Identifying the position at which the maximum age variance occurs.
This is useful if you wanted to pick the one next position to date</li>
<li>Identifying which date is the most influential on the chronology.
This is useful if you are concerned that one date might be leading the
chronology astray.</li>
</ol>
<p>Identifying the position of maximum age variance can be created with
the <code>summary</code> command:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">summary</span>(GlenOut, <span class="at">type =</span> <span class="st">&quot;max_var&quot;</span>)</span></code></pre></div>
<pre><code>## Top 3 positions with maximum age variance are: 
## 750 760 740</code></pre>
<p>You can control the number of positions reported with
<code>numPos</code>. For example you could now add a line to mark the
most variably layer to the plot with:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>max_var <span class="ot">&lt;-</span> <span class="fu">summary</span>(GlenOut, <span class="at">type =</span> <span class="st">&quot;max_var&quot;</span>, <span class="at">numPos =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Position with maximum age variance is: 
## 750</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">plot</span>(GlenOut) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Glendalough&quot;</span>,</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age (cal years BP)&quot;</span>,</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Depth (cm)&quot;</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> max_var)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finding the date which has maximum influence in the core is a more
computationally intensive procedure and involves running the Bchron
model repeatedly, leaving each date out in turn, and quantifying the
effect on the chronology of removing each date. The function is called
<code>dateInfluence</code>. Note that you provide this function with a
full run of the Bchron model.</p>
<p>To find the influence, say, of date <code>Beta-100901</code> as the
median date shift in years when is removed, we would run:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">dateInfluence</span>(GlenOut,</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  <span class="at">whichDate =</span> <span class="st">&quot;Beta-100901&quot;</span>,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="at">measure =</span> <span class="st">&quot;absMedianDiff&quot;</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Alternatively, to find the influence of all the dates in terms of the
median shift we could use:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">dateInfluence</span>(GlenOut,</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>  <span class="at">whichDate =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>  <span class="at">measure =</span> <span class="st">&quot;absMedianDiff&quot;</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>)</span></code></pre></div>
<p>A more complete measure of influence is the Kullback-Leibler (KL)
divergence which takes account of the change in the full probability
distribution rather than just looking at mean or median age differences
when that particular date is left out. The KL divergence version could
then be run using:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">dateInfluence</span>(GlenOut,</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="at">whichDate =</span> <span class="st">&quot;all&quot;</span>,</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="at">measure =</span> <span class="st">&quot;KL&quot;</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>)</span></code></pre></div>
<p>The interpretation here is relative. The dates with the largest KL
divergence values have the most influence on the chronology in the
core.</p>
</div>
<div id="running-rsl-rate-estimation" class="section level2">
<h2>Running RSL rate estimation</h2>
<p>The function <code>BchronRSL</code> will produce estimated relative
sea level rates from a regression model taking into account the
uncertainties in age provided by a <code>Bchronology</code> run as
above. Two example data sets are provided:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">data</span>(TestChronData)</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="fu">data</span>(TestRSLData)</span></code></pre></div>
<p>These can be run through Bchronology and BchronRSL via:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>RSLchron <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  TestChronData,</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">Bchronology</span>(</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>    <span class="at">ages =</span> ages,</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>    <span class="at">ageSds =</span> ageSds,</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>    <span class="at">positions =</span> position,</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>    <span class="at">positionThicknesses =</span> thickness,</span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>    <span class="at">ids =</span> id,</span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>    <span class="at">calCurves =</span> calCurves,</span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>    <span class="at">predictPositions =</span> TestRSLData<span class="sc">$</span>Depth</span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>  )</span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>)</span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a>RSLrun <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a>  TestRSLData,</span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a>  <span class="fu">BchronRSL</span>(RSLchron,</span>
<span id="cb45-16"><a href="#cb45-16" tabindex="-1"></a>    <span class="at">RSLmean =</span> RSL,</span>
<span id="cb45-17"><a href="#cb45-17" tabindex="-1"></a>    <span class="at">RSLsd =</span> Sigma,</span>
<span id="cb45-18"><a href="#cb45-18" tabindex="-1"></a>    <span class="at">degree =</span> <span class="dv">3</span></span>
<span id="cb45-19"><a href="#cb45-19" tabindex="-1"></a>  )</span>
<span id="cb45-20"><a href="#cb45-20" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code>Bchronology</code> run is as described in the section
above. The <code>BChronRSL</code> run takes this object, an estimate of
the RSL means and standard deviations, and a value of degree (here 3
indicating cubic regression). They can then be summarised and plotted
via:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="fu">summary</span>(RSLrun, <span class="at">type =</span> <span class="st">&quot;RSL&quot;</span>, <span class="at">age_grid =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2000</span>, <span class="at">by =</span> <span class="dv">250</span>))</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="fu">plot</span>(RSLrun, <span class="at">type =</span> <span class="st">&quot;RSL&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relative sea level plot&quot;</span>)</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a><span class="fu">plot</span>(RSLrun, <span class="at">type =</span> <span class="st">&quot;rate&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Rate of RSL change&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Rate (mm per year)&quot;</span>)</span></code></pre></div>
<p>See the help files for more options, including outputting parameter
values, and plots of acceleration of RSL itself.</p>
</div>
<div id="running-non-parametric-phase-estimation"
class="section level2">
<h2>Running non-parametric phase estimation</h2>
<p>Bchron contains two functions for running non-parametric phase models
for estimating activity level in a site/region. The first, BchronDensity
fits a full Bayesian Gaussian mixture model to the radiocarbon dates
whilst the second <code>BchronDensityFast</code> fits an approximate
version which will run on much larger data sets. An example run is</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">data</span>(Sluggan)</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>SlugDens <span class="ot">&lt;-</span> <span class="fu">BchronDensity</span>(</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>  <span class="at">ages =</span> Sluggan<span class="sc">$</span>ages,</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>  <span class="at">ageSds =</span> Sluggan<span class="sc">$</span>ageSds,</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>  <span class="at">calCurves =</span> Sluggan<span class="sc">$</span>calCurves</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>)</span></code></pre></div>
<p>You can then output the possible start/end dates of phases:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">summary</span>(SlugDens, <span class="at">prob =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<p>The probability argument will specify the sensitivity of the
algorithm to finding phases. Lower values of <code>prob</code> will lead
to more discovered phases.</p>
<p>You can plot the density with:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="fu">plot</span>(SlugDens, <span class="at">xlab =</span> <span class="st">&quot;Age (cal years BP)&quot;</span>, <span class="at">xaxp =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">16000</span>, <span class="dv">16</span>))</span></code></pre></div>
<p>Phases will be shown with a thick black red line. These can be turned
off by setting the argument <code>plotPhase=FALSE</code> whilst the
sensitivity can be changed with <code>phaseProb</code>.</p>
<p><code>BchronDensityFast</code> is identical except for the function
call:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>SlugDensFast <span class="ot">&lt;-</span> <span class="fu">BchronDensityFast</span>(</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>  <span class="at">ages =</span> Sluggan<span class="sc">$</span>ages,</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a>  <span class="at">ageSds =</span> Sluggan<span class="sc">$</span>ageSds,</span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a>  <span class="at">calCurves =</span> Sluggan<span class="sc">$</span>calCurves</span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>)</span></code></pre></div>
<p>The <code>BchronDensityFast</code> function outputs the age grid and
density by default so requires no extra arguments to store it.</p>
</div>
<div id="including-user-defined-calibration-curves"
class="section level2">
<h2>Including user-defined calibration curves</h2>
<p>Bchron allows for user-defined calibration curves to be created
through the function <code>createCalCurve</code>. If inputs to this
function are:</p>
<ul>
<li>The <code>name</code> of the calibration curve (e.g. intcal20)</li>
<li>The calibrated/calendar ages for the new calibration curve</li>
<li>The uncalibrated (e.g. 14C) ages for the new calibration curve</li>
<li>(Optionally) the 1-sigma error for the calibration curve in
uncalibrated years. If not included the error is assumed to be zero</li>
<li>(Optionally) The path to where the resulting file will be
stored</li>
</ul>
<p>Once run, the calibration curve needs to be moved from the chosen
path (by default the working directory) to the location of the other
calibration curves. This is by default
<code>system.file('data',package='Bchron')</code>. The resulting
calibration curve can be used for all future runs until the package is
deleted or re-installed. The calibration curve can be used by simply
calling it in any other Bchron function using the supplied name. Note
that no name checking is done, so it is possible to over-write the
pre-defined calibration curves if the user is not careful.</p>
<p>We now consider an example of loading in and creating the IntCal09
calibration curve:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># Load in the calibration curve with:</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>intcal09 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata/intcal09.14c&quot;</span>,</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">&quot;Bchron&quot;</span></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>), <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a><span class="co"># Run createCalCurve</span></span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="fu">createCalCurve</span>(</span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;intcal09&quot;</span>, <span class="at">calAges =</span> intcal09[, <span class="dv">1</span>],</span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a>  <span class="at">uncalAges =</span> intcal09[, <span class="dv">2</span>], <span class="at">oneSigma =</span> intcal09[, <span class="dv">3</span>]</span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a>)</span></code></pre></div>
<p>The new calibration curve now needs to be moved to the Bchron package
directory. You can do this with the following code:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="st">&quot;intcal09.rda&quot;</span>, <span class="fu">system.file</span>(<span class="st">&quot;data&quot;</span>, <span class="at">package =</span> <span class="st">&quot;Bchron&quot;</span>))</span></code></pre></div>
<p>It can then be used via its name. For example, we can now compare the
calibration of a date under the intcal09 curve with that of
intcal20:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>age_09 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">15500</span>, <span class="at">ageSds =</span> <span class="dv">150</span>, <span class="at">calCurves =</span> <span class="st">&quot;intcal09&quot;</span>,</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>  <span class="at">ids =</span> <span class="st">&quot;IntCal09&quot;</span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>)</span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>age_20 <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">15500</span>, <span class="at">ageSds =</span> <span class="dv">150</span>, <span class="at">calCurves =</span> <span class="st">&quot;intcal20&quot;</span>,</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>  <span class="at">ids =</span> <span class="st">&quot;Intcal20&quot;</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>)</span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a><span class="fu">plot</span>(age_09) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(age_20<span class="sc">$</span>Intcal20),</span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> ageGrid, <span class="at">y =</span> densities), <span class="at">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Intcal09 vs Intcal20&quot;</span>)</span></code></pre></div>
</div>
<div id="calibrating-marine-and-other-offset-age-ranges"
class="section level2">
<h2>Calibrating marine and other offset age ranges</h2>
<p>Periodically people want to calibrate dates which have an age offset
and an offset error. This is very simple in Bchron and requires no
additional Bchron commands. So for example, if you had a date of 3000
14C years with 1-sigma error of 50 14C years, but you want to
incorporate a reservoir correction with 80 14C years and a 1-sigma error
of 30 14C years, then you can just calibrate 3080 years with a
radiocarbon error of sqrt(50^2 + 30^2) = 58.3 years. In Bchron this
becomes:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>age_rc <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">3000</span> <span class="sc">+</span> <span class="dv">80</span>,</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="fu">sqrt</span>(<span class="dv">50</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">30</span><span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="st">&quot;marine20&quot;</span>,</span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>  <span class="at">ids =</span> <span class="st">&quot;Res_corr&quot;</span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>)</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a><span class="fu">summary</span>(age_rc)</span></code></pre></div>
<pre><code>## 95% Highest density regions for Res_corr
## $`94.5%`
## [1] 2487 2884</code></pre>
<p>These offset adjustments can be used in a <code>Bchronology</code>
type run by storing the offsets and their standard deviations in a
vector. So a call to <code>Bchronology</code> might become:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>myChron <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>  myDataSet,</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>  <span class="fu">Bchronology</span>(</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>    <span class="at">ages =</span> ages <span class="sc">+</span> offsets,</span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a>    <span class="at">ageSds =</span> <span class="fu">sqrt</span>(ageSds <span class="sc">+</span> offsetSds),</span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a>    <span class="at">calCurves =</span> calCurves,</span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a>    <span class="at">positions =</span> positions,</span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a>    <span class="at">positionThicknesses =</span> thicknesses,</span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a>    <span class="at">ids =</span> ids</span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a>  )</span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="uncalibrating-dates" class="section level2">
<h2>Uncalibrating dates</h2>
<p>Sometimes it is useful to turn a calendar age estimate into an
uncalibrated age. This might be for simulation or model checking
purposes. ‘Un-calibrating’ dates can be implemented in Bchron using the
<code>unCalibrate</code> function. There are two versions, one where you
have a single age and just want to get a quick look up of the 14C age,
and another where you have the full distribution of the calibrated age
and want to estimate both the 14C age and its associated error.</p>
<p>The simple version can be run with, e.g.:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>unCal1 <span class="ot">&lt;-</span> <span class="fu">unCalibrate</span>(<span class="dv">2350</span>, <span class="at">type =</span> <span class="st">&quot;ages&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="fu">print</span>(unCal1)</span></code></pre></div>
<pre><code>## [1] 2352</code></pre>
<p>The above un-calibrates the age 2350 BP to the age 2346 14C years BP
on the intcal20 calibration curve. A more advanced version would be:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>unCal2 <span class="ot">&lt;-</span> <span class="fu">unCalibrate</span>(</span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>  <span class="at">calAge =</span> <span class="fu">c</span>(<span class="dv">2350</span>, <span class="dv">4750</span>, <span class="dv">11440</span>),</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;ages&quot;</span>,</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>  <span class="at">calCurve =</span> <span class="st">&quot;intcal20&quot;</span></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="fu">print</span>(unCal2)</span></code></pre></div>
<pre><code>## [1]  2352  4176 10021</code></pre>
<p>A fun experiment can then be run to see what the distribution of 14C
ages would look like for an even distribution of calendar ages:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>ageRange <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">8000</span>, <span class="dv">9000</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>c14Ages <span class="ot">&lt;-</span> <span class="fu">unCalibrate</span>(ageRange,</span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;ages&quot;</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>)</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">system.file</span>(<span class="st">&quot;data/intcal20.rda&quot;</span>, <span class="at">package =</span> <span class="st">&quot;Bchron&quot;</span>))</span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a><span class="fu">ggplot</span>(intcal20, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2)) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">range</span>(ageRange)) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">range</span>(c14Ages)) <span class="sc">+</span></span>
<span id="cb63-11"><a href="#cb63-11" tabindex="-1"></a>  <span class="fu">geom_rug</span>(</span>
<span id="cb63-12"><a href="#cb63-12" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(c14Ages), <span class="fu">aes</span>(<span class="at">y =</span> c14Ages),</span>
<span id="cb63-13"><a href="#cb63-13" tabindex="-1"></a>    <span class="at">sides =</span> <span class="st">&quot;l&quot;</span>, <span class="at">inherit.aes =</span> F</span>
<span id="cb63-14"><a href="#cb63-14" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" tabindex="-1"></a>  <span class="fu">geom_rug</span>(</span>
<span id="cb63-16"><a href="#cb63-16" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(ageRange), <span class="fu">aes</span>(<span class="at">x =</span> ageRange),</span>
<span id="cb63-17"><a href="#cb63-17" tabindex="-1"></a>    <span class="at">sides =</span> <span class="st">&quot;b&quot;</span>, <span class="at">inherit.aes =</span> F</span>
<span id="cb63-18"><a href="#cb63-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-19"><a href="#cb63-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Calendar years BP&quot;</span>, <span class="at">y =</span> <span class="st">&quot;14C years BP&quot;</span>)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Unsurprisingly the places where the calibration curve is flat (or
reverses) leads to ‘clumps’ of calendar ages.</p>
<p>The more complicated version is run by providing it with a
(preferably large) sample of ages which form a calibrated date. Such a
set is created with Bchron via <code>sampleAges</code>, e.g.:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>calAge <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="dv">11255</span>,</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="dv">25</span>,</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="at">calCurves =</span> <span class="st">&quot;intcal20&quot;</span></span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>)</span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>calSampleAges <span class="ot">&lt;-</span> <span class="fu">sampleAges</span>(calAge)</span></code></pre></div>
<p>We can now uncalibrate such a set of samples</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>unCal <span class="ot">&lt;-</span> <span class="fu">unCalibrate</span>(calSampleAges,</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;samples&quot;</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">print</span>(unCal)</span></code></pre></div>
<pre><code>## $mean
## [1] 11240
## 
## $sd
## [1] 27</code></pre>
<p>This will provide a single best estimate of the mean and standard
deviation of the uncalibrated (here 14C) date.</p>
</div>
<div id="miscellaneous-other-queries" class="section level1">
<h1>Miscellaneous other queries</h1>
<div id="customising-plots" class="section level2">
<h2>Customising plots</h2>
<p>We can use standard <code>ggplot2</code> commands to customise some
of the plots. For example, suppose we created the standard Glendalough
chronology:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">data</span>(Glendalough)</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>GlenOut <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>  Glendalough,</span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>  <span class="fu">Bchronology</span>(</span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a>    <span class="at">ages =</span> ages,</span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>    <span class="at">ageSds =</span> ageSds,</span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>    <span class="at">calCurves =</span> calCurves,</span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>    <span class="at">positions =</span> position,</span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a>    <span class="at">positionThicknesses =</span> thickness,</span>
<span id="cb68-10"><a href="#cb68-10" tabindex="-1"></a>    <span class="at">ids =</span> id,</span>
<span id="cb68-11"><a href="#cb68-11" tabindex="-1"></a>    <span class="at">predictPositions =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb68-12"><a href="#cb68-12" tabindex="-1"></a>  )</span>
<span id="cb68-13"><a href="#cb68-13" tabindex="-1"></a>)</span></code></pre></div>
<p>And suppose we want to plot the data with customised axis labels and
a title:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a><span class="fu">plot</span>(GlenOut) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Glendalough&quot;</span>,</span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age (cal years BP)&quot;</span>,</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Depth (cm)&quot;</span></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now suppose we want to plot the chronology but add in the 14C date
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7000</mn><mo>±</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">7000 \pm 40</annotation></semantics></math>
at depth 600cm. First we calibrated that date</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a>new_cal <span class="ot">&lt;-</span> <span class="fu">BchronCalibrate</span>(</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>  <span class="at">ages =</span> <span class="dv">7000</span>,</span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a>  <span class="at">ageSds =</span> <span class="dv">40</span>,</span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a>  <span class="at">calCurve =</span> <span class="st">&quot;intcal20&quot;</span></span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a>)</span></code></pre></div>
<p>Finally we create the plot and add the date as a new layer (with a
new colour too):</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a><span class="fu">plot</span>(GlenOut) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a>  <span class="fu">geom_ridgeline</span>(</span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(new_cal<span class="sc">$</span>Date1),</span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a>      <span class="at">x =</span> ageGrid,</span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>      <span class="at">y =</span> <span class="dv">600</span>,</span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a>      <span class="at">height =</span> densities <span class="sc">*</span> <span class="dv">10000</span>, <span class="co"># Note the 10000 came from trial and error</span></span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a>      <span class="at">group =</span> <span class="st">&quot;New date&quot;</span>,</span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>    ),</span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb71-12"><a href="#cb71-12" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb71-13"><a href="#cb71-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-14"><a href="#cb71-14" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">9000</span>, <span class="at">y =</span> <span class="dv">570</span>, <span class="at">label =</span> <span class="st">&quot;New date&quot;</span>)</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-53-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="adding-a-second-chronology" class="section level3">
<h3>Adding a second chronology</h3>
<p>Suppose we want to over-plot a second chronology where we had removed
one of the dates. First create the second chronology you want to
produce:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>GlenOut2 <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>  Glendalough[<span class="sc">-</span><span class="dv">2</span>,],</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>  <span class="fu">Bchronology</span>(</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>    <span class="at">ages =</span> ages,</span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>    <span class="at">ageSds =</span> ageSds,</span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>    <span class="at">calCurves =</span> calCurves,</span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>    <span class="at">positions =</span> position,</span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>    <span class="at">positionThicknesses =</span> thickness,</span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>    <span class="at">ids =</span> id,</span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>    <span class="at">predictPositions =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">by =</span> <span class="dv">10</span>)</span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a>  )</span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a>)</span></code></pre></div>
<p>Now create a new data frame with the ranges of the new chronology</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>chronRange <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>      <span class="at">chronLow =</span> <span class="fu">apply</span>(GlenOut2<span class="sc">$</span>thetaPredict, <span class="dv">2</span>, <span class="st">&quot;quantile&quot;</span>, <span class="at">probs =</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>      <span class="at">chronMed =</span> <span class="fu">apply</span>(GlenOut2<span class="sc">$</span>thetaPredict, <span class="dv">2</span>, <span class="st">&quot;quantile&quot;</span>, <span class="at">probs =</span> <span class="fl">0.5</span>),</span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>      <span class="at">chronHigh =</span> <span class="fu">apply</span>(GlenOut2<span class="sc">$</span>thetaPredict, <span class="dv">2</span>, <span class="st">&quot;quantile&quot;</span>, <span class="at">probs =</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> alpha) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>      <span class="at">positions =</span> GlenOut2<span class="sc">$</span>predictPositions</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>    )</span></code></pre></div>
<p>Next create a data frame that Bchron can use to plot the chronology.
The clever trick here is to put the ages on a grid and approximate the
uncertainty in the position (or depth) direction using linear
interpolation.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>ageGrid <span class="ot">&lt;-</span> <span class="fu">with</span>(chronRange, <span class="fu">seq</span>(<span class="fu">min</span>(chronLow), <span class="fu">max</span>(chronHigh),</span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>      <span class="at">length =</span> <span class="fu">nrow</span>(chronRange)</span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>    ))</span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>chronRangeSwap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a>      <span class="at">Age =</span> ageGrid,</span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>      <span class="at">positionLow =</span> <span class="fu">with</span>(chronRange, <span class="fu">approx</span>(chronLow, positions,</span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a>        <span class="at">xout =</span> ageGrid,</span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a>        <span class="at">rule =</span> <span class="dv">2</span></span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a>      )<span class="sc">$</span>y),</span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a>      <span class="at">Position =</span> <span class="fu">with</span>(chronRange, <span class="fu">approx</span>(chronMed, positions,</span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a>        <span class="at">xout =</span> ageGrid,</span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a>        <span class="at">rule =</span> <span class="dv">2</span></span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a>      )<span class="sc">$</span>y),</span>
<span id="cb74-14"><a href="#cb74-14" tabindex="-1"></a>      <span class="at">positionHigh =</span> <span class="fu">with</span>(chronRange, <span class="fu">approx</span>(chronHigh, positions,</span>
<span id="cb74-15"><a href="#cb74-15" tabindex="-1"></a>        <span class="at">xout =</span> ageGrid,</span>
<span id="cb74-16"><a href="#cb74-16" tabindex="-1"></a>        <span class="at">rule =</span> <span class="dv">2</span></span>
<span id="cb74-17"><a href="#cb74-17" tabindex="-1"></a>      )<span class="sc">$</span>y),</span>
<span id="cb74-18"><a href="#cb74-18" tabindex="-1"></a>      <span class="at">Date =</span> <span class="st">&quot;Bchron&quot;</span>,</span>
<span id="cb74-19"><a href="#cb74-19" tabindex="-1"></a>      <span class="at">densities =</span> <span class="cn">NA</span>,</span>
<span id="cb74-20"><a href="#cb74-20" tabindex="-1"></a>      <span class="at">height =</span> <span class="cn">NA</span></span>
<span id="cb74-21"><a href="#cb74-21" tabindex="-1"></a>    )</span></code></pre></div>
<p>And finally add into the plot:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">plot</span>(GlenOut, <span class="at">dateLabels =</span> <span class="cn">FALSE</span>, <span class="at">chronTransparency =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a>        <span class="at">data =</span> chronRangeSwap,</span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a>        <span class="fu">aes</span>(</span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>          <span class="at">x =</span> Age,</span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>          <span class="at">ymin =</span> positionLow,</span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>          <span class="at">ymax =</span> positionHigh</span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a>        ),</span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a>        <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb75-10"><a href="#cb75-10" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb75-11"><a href="#cb75-11" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb75-12"><a href="#cb75-12" tabindex="-1"></a>      )</span></code></pre></div>
<p><img src="Bchron_files/figure-html/unnamed-chunk-57-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>For a description of the kind of things that Bchron can do:<br />
Parnell, A. C., Haslett, J., Allen, J. R. M., Buck, C. E., &amp;
Huntley, B. (2008). A flexible approach to assessing synchroneity of
past events using Bayesian reconstructions of sedimentation history.
Quaternary Science Reviews, 27(19-20), 1872–1885.</p>
<p>For the maths behind Bchron:<br />
Haslett, J., &amp; Parnell, A. (2008). A simple monotone process with
application to radiocarbon-dated depth chronologies. Journal of the
Royal Statistical Society: Series C (Applied Statistics), 57(4),
399–418.</p>
<p>For a review of chronology models:<br />
Parnell, A. C., Buck, C. E., &amp; Doan, T. K. (2011). A review of
statistical chronology models for high-resolution, proxy-based Holocene
palaeoenvironmental reconstruction. Quaternary Science Reviews,
30(21-22), 2948–2960.</p>
<p>For relative sea level rate estimation:<br />
Parnell, A. C., &amp; Gehrels, W. R. (2015). Using chronological models
in late Holocene sea level reconstructions from salt marsh sediments.
In: I. Shennan, B.P. Horton, and A.J. Long (eds). Handbook of Sea Level
Research. Chichester: Wiley.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Andrew Parnell.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>
